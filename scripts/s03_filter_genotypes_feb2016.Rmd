---
title: "Filter genotypes, wecare feb2016"
author: "Alexey Larionov"
output: html_document
---

started: Mar2016
last updated: 26Apr2016

# start_section

```{r start_section}

# Time stamp
Sys.time()

# Clean-up
rm(list=ls())
graphics.off()

# Set root working folder
library(knitr)

#opts_knit$set(root.dir = "/scratch/medgen/users/alexey/wecare_feb2016/wecare_feb2016_r")
#setwd("/scratch/medgen/users/alexey/wecare_feb2016/wecare_feb2016_r")

#opts_knit$set(root.dir = "C:\\Users\\larion01\\Documents\\GitHub\\R1")
#setwd("C:\\Users\\larion01\\Documents\\GitHub\\R1")

```

# load_and_check_data

```{r load_and_check_data}

load(file="data/s02_filter_variants_feb2016.RData")
ls()

dim(covar.df)
colnames(covar.df)
str(covar.df)
covar.df[1:5,1:5]

dim(demographics.df)
colnames(demographics.df)
str(demographics.df)
demographics.df[1:5,1:5]

dim(samples.df)
colnames(samples.df)
str(samples.df)
samples.df[1:5,]

dim(vv.pf.df)
colnames(vv.pf.df)
str(vv.pf.df)
vv.pf.df[1:5,1:3]

dim(gt.pf.df)
gt.pf.df[1:5,1:3]

dim(gq.pf.df)
gq.pf.df[1:5,1:3]

dim(dp.pf.df)
dp.pf.df[1:5,1:3]

dim(ad.pf.df)
ad.pf.df[1:5,1:3]

# Check consistence of rownames
sum(rownames(gt.pf.df) != rownames(vv.pf.df), na.rm=TRUE)

sum(rownames(gt.pf.df) != rownames(gq.pf.df), na.rm=TRUE)
sum(rownames(gt.pf.df) != rownames(dp.pf.df), na.rm=TRUE)
sum(rownames(gt.pf.df) != rownames(ad.pf.df), na.rm=TRUE)

# Check consistence of colnames
sum(substr(colnames(gt.pf.df),0,6) != substr(colnames(gq.pf.df),0,6), na.rm=TRUE)
sum(substr(colnames(gt.pf.df),0,6) != substr(colnames(dp.pf.df),0,6), na.rm=TRUE)
sum(substr(colnames(gt.pf.df),0,6) != substr(colnames(ad.pf.df),0,6), na.rm=TRUE)

```

# prepare_tables

```{r prepare_tables}

# Converet to matrices
gt.pf.mx <- as.matrix(gt.pf.df)
gq.pf.mx <- as.matrix(gq.pf.df)
dp.pf.mx <- as.matrix(dp.pf.df)
rm(gt.pf.df, gq.pf.df, dp.pf.df)

# Convert ad table

```

# estimate_num_of_genotypes_to_remove

```{r estimate_num_of_genotypes_to_remove}

# Genoptypes NA rate before genotypes filtering
sum(is.na(gt.pf.msk.mx))/(dim(gt.pf.msk.mx)[1]*dim(gt.pf.msk.mx)[2]) # ~7%

# Types of genotypes to be excluded by masking
sum(gq.pf.mx < 20, na.rm=TRUE)/(dim(gt.pf.mx)[1]*dim(gt.pf.mx)[2]) # ~5%
sum(dp.pf.mx < 10, na.rm=TRUE)/(dim(dp.pf.mx)[1]*dim(dp.pf.mx)[2]) # ~7%
#ad

```

# filter_by_gq

```{r filter_by_gq}

gt.pf.msk.mx <- gt.pf.mx
NA -> gt.pf.msk.mx[ gq.pf.mx < 20 ]
rm(gt.pf.mx, gq.pf.mx)


```

# filter_by_dp

```{r filter_by_dp}

NA -> gt.pf.msk.mx[ dp.pf.mx < 10 ]
rm(dp.pf.mx)

```

# filter_by_ad

```{r filter_by_ad}

# tba

```

# NA_rate_after_filtering

```{r NA_rate_after_filtering}

dim(gt.pf.msk.mx)
sum(is.na(gt.pf.msk.mx))/(dim(gt.pf.msk.mx)[1]*dim(gt.pf.msk.mx)[2]) # ~7%

```

# save_data

```{r save_data}

save.image(file="data/s03_filter_genotypes_feb2016.RData")

```

# final_section

```{r final_section}

sessionInfo()
Sys.time()

```

